# 数据链路层

数据链路层使用的信道主要有两种类型**点对点通信**和**广播通信**

## 点对点信道的数据链路

首先要知道链路和数据链路的区别，链路指的是两个相邻节点的物理线路（可以是有线的也可以是无限的），当计算机交换信息时经过的路劲包括很多条这样的链路。

数据链路指的是当数据在链路上传播时需要一些协议来控制传输的数据，把实现这些协议的硬件和软件加在上面就是数据链路。

数据链路层的协议数据单元是**帧**

数据链路层负责把网络层传来的IP数据报（或者叫分组，包等）封装成帧，以及把接收到的帧解封成IP数据包传给网络层。当我们把精力放在数据链路层上，把IP/TCP协议简化成三层可以看到在两个节点之间数据链路层是怎么工作的：

![image-20200824170946174](D:\Note\img\数据链路层运行方式.png)

可以看到点对点通信时数据链路层的主要步骤有

1. 结点A的数据链路层把网络层传下来的IP数据包添加头部和尾部封装成帧
2. 结点A把封装好的帧通过物理层发送给节点B的数据链路层
3. B收到帧后检查发现无差错就把该帧交给B的网络层，否则丢弃改帧

链路层无需关注物理层的细节，甚至可以抽象成水平发送。

### 三个问题

链路层的协议很多，但是这些协议都要面对三个基本问题：**封装成帧**、**透明传输**、**差错检验**

#### 封装成帧

帧就是IP数据报加上首部和尾部组成的传输单元，因为物理层的传输是连续的，所以帧的首要功能就是帧定界，确定哪些数据范围内的数据是一个IP数据包，当然除此之外首部和尾部好包括许多必要的控制信息，显然为了传输效率，帧的首部和尾部相对于数据部分来说应该越短越好，但是链路层协议都会规定每个帧数据部分的最大长度即MTU(最大传输单元)。

![image-20200824171918394](D:\Note\img\帧的组成部分.png)

我们知道ASCII码由7位组成，共有127个字符，其中95个可打印，不可打印的有33个，因此当我们传输的是ASCII码文本文件时可以使用不可打印的控制字符来界定帧开始和帧结束。通常他们是SOH(start of header)对应二进制00000001和EOT(end of transmission)对应的二进制码为00000100

![image-20200824172702493](D:\Note\img\帧的界定.png)

#### 透明传输

透明的意思是指，某样存在的东西但是我们看不见他，就像玻璃一样。对于数据链路层来说就是无论数据是什么样的数据链路层都能将他们传输过去，仿佛数据链路层不存在一般。我们知道帧对于传输ASCII文本字符来说是透明的，因为SOH和EOT是无法打印的控制字符所以帧不会出现差错。但是如果传输的数据是图片之类的二进制流就会出现00000001或者00000100这样的字节流会被错误的认为是帧的开始或者结束，那么包装成帧就影响了数据的传输就不透明了。为了解决这个问题发送端会在数据链路层出现SOH或者EOT之前插入一个转义字符"ESC"实际上就是(00011011)在传输到网络层之前再删除这些转义字符，当出现ESC时可以在ESC前再加上一个ESC，这种方法称为字节填充。

![image-20200824173521336](D:\Note\img\帧的字节填充.png)

#### 差错检测

差错检测不同于传输层的可靠传输，链路层的差错检测指的是比特出错，就是数据在物理层传播时有0变成1或者1变成0。物理层传输时会有个指标叫误码率(BER)指的是数据传播中传输错误的比特数占所有比特数的百分比。即使现在误码率很低但是也不可能变为0所以在网络各层中都有差错检测技术，数据链路层普遍使用的时**循环冗余检查技术(CRC)**,CRC具体算法如下：

![image-20200824174347079](D:\Note\img\CRC算法.png)

### PPP协议

。。。。